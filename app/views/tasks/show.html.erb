
<div class='user-id' data-id="<%= @task.user.id %>"></div>
<div class='task-id' data-id="<%= @task.id %>"></div>
<div id='task-show-wrapper' class='show-container'>


    <div class='heading-container contact-item-container'>
        <div class='edit-delete'>
            <td><%= link_to "Edit", edit_user_task_path(@task.user, @task) %></td>
            <td><%= link_to "Delete", user_task_path(@task.user, @task), :method => :delete %></td>
        </div>


        <span class="headline pg-btn btn-previous"><i class="fa fa-long-arrow-left"></i></span>
        <h1 id='task-title' class='headline'><%= @task.title %></h1>
        <span class="headline pg-btn btn-next"><i class="fa fa-long-arrow-right"></i></span>
    </div> <!-- close container -->


    <div id="task-description-container">
        <div id='task-description'>
        	<h3>Description: <%= @task.description %></h3>
        </div>
        <div id='date-due'><h3>DUE DATE: <%= format_date(@task.due_date) %></h3></div>
    </div>


    <div id='completed-container'>
        <section id='completed-section'>
            <div id='task-completed-string'></div>
            <div id='completed-toggle'><input type="checkbox" id="switch"><label id='switch-label' for="switch">Toggle</label></div>
        </section>
    </div> <!-- close container -->

    
    <div class='linked-items'>
        <section class='linked-items-section'>

            <div id='task-linked-doc-container' class='linked-container'>
                <% if @task.documents != [] %>   
                    <h2 class='linked-item'>LINKED DOCUMENTS</h2>
               
                    <input type="submit" name="commit" value="unLink Document" id="btn-add-contact" class='unlink-doc' data-disable-with="Link Contact">

                <% else %>
                    <h2 class='unlinked-item'>No linked Documents</h2>
                    <%= render 'documents/document_task_dropdown' %>
                <% end %>
            </div> <!-- close container -->


            <div id='task-linked-contact-container' class='linked-container'>
                <% if @task.contact != nil %>   
                    <h2 class='linked-item'>LINKED CONTACTS </h2>

                    <input type="submit" name="commit" value="unLink Document" id="btn-add-contact" class='unlink-contact' data-disable-with="Link Contact">

                    
                <% else %>
                    <h2 class='unlinked-item'>No linked contacts</h2>
                    <%= render 'contacts/contact_task_dropdown' %>
                <% end %>
            </div> <!-- close container -->


            <div id='task-linked-job-container' class='linked-container'>
                <% if @task.job != nil %>   
                    <h2 class='linked-item'>LINKED JOBS</h2>
                    
                    <input type="submit" name="commit" value="unLink Document" id="btn-add-contact" class='unlink-job' data-disable-with="Link Contact">

                <% else %>
                    <h2 class='unlinked-item'>No linked jobs</h2>
                    <%= render 'jobs/job_task_dropdown' %>
                <% end %>
            </div> <!-- close container -->
        </section>
    </div> <!-- close container -->

</div> <!-- close wrapper -->




<script>


$( document ).on('turbolinks:load', function() {
    user_id = $(".user-id").data("id")
    task_id = $(".task-id").data("id")

    $.get(`/users/${user_id}/tasks/${task_id}.json`, function(data) {
        task = new Task(data, user_id)
        displayCompletedStatus(task)
        toggleCompleted(task)
        // linkTaskContact()
        // linkTaskDocument()
        // linkTaskJob()
        // unlinkContact()
        // unlinkDocument()
        // unlinkJob()

    });
    
})



const toggleCompleted = function (task) {
    // place click listener on toggle
    $('#switch').on('click', function() {
        // route changing to new status
        task.completed = !task.completed;
        $.get(`/users/${user_id}/tasks/${task_id}/completed?q=${task.completed}`, function(data) {
            $('#task-completed-string').html(task.completedString(task.completed))
        })
    })
}

const displayCompletedStatus = function(task) {
    $('#task-completed-string').html(task.completedString())
    let tog = document.getElementById("switch")
    tog.checked = task.completed;
}





// const linkTaskContact = function() {
//     $('#btn-add-contact').on('click', function(e) {
//         e.preventDefault()
//         var form = $('#add-contact')

//         var action = form.attr('action')
//         var c_id = form.serialize()


//         $.ajax({url: `/users/${user_id}/tasks/${task_id}/link_contact`, 
//             data: c_id, 
//             type: "PATCH", 
//             success: function (data) {
//                 alert('success') 
//                 $('#task-contacts').append(`<a href="/users/2/contacts/11">Rachel  Maddow</a>`)
//             },
//             error: function (data) {
//                 alert('no success') }

//         })
//     })
// }


// const linkTaskDocument = function() {
//     $('#btn-add-document').on('click', function(e) {
//         e.preventDefault()
//         var form = $('#add-document')
//         var action = form.attr('action') //necessary?
//         var d_id = form.serialize()

//         $.ajax({url: `/users/${user_id}/tasks/${task_id}/link_document`, 
//             data: d_id, 
//             type: "PATCH", 
//             success: function (data) {
//                 console.log('data')
//                 console.log(data)
//                 alert('success') },
//             error: function (data) {
//                 alert('no success') }
//         })
//     })
// }


// const linkTaskJob = function() {
//     let jobId = $('#task-job-ids')
//     $('#btn-add-job').on('click', function(e) {
//         e.preventDefault()
//         var form = $('#add-job')
//         var action = form.attr('action')
//         var j_id = form.serialize()

//         $.ajax({url: `/users/${user_id}/tasks/${task_id}/link_job`, 
//             data: j_id, 
//             type: "PATCH", 
//             success: function (data) {
//                 console.log('data')
//                 console.log(data)
//                 alert('success') },
//             error: function (data) {
//                 alert('no success') }
//         })
//     })
// }


// const unlinkContact = function (task) {
//     $('.unlink-contact').on('click', function(e) {
//         e.preventDefault()
//         $.get(`/users/${user_id}/tasks/${task_id}/unlink_contact`, function(data) {
//             console.log(data)
//         })
//     })
// }


// const unlinkDocument = function (task) {
//     $('.unlink-doc').on('click', function(e) {
//         e.preventDefault()
//         $.get(`/users/${user_id}/tasks/${task_id}/unlink_document`, function(data) {
//             console.log(data)
//         })
//     })
// }

// const unlinkJob = function (task) {
//     $('.unlink-job').on('click', function(e) {
//         e.preventDefault()
//         $.get(`/users/${user_id}/tasks/${task_id}/unlink_job`, function(data) {
//             console.log(data)
//         })
//     })
// }




</script>
